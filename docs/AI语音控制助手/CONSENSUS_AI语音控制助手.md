# 共识文档 - AI语音控制助手

## 📋 项目基本信息

| 项目属性 | 确定内容 |
|---------|---------|
| **项目名称** | VoicePC - 智能语音电脑助手 |
| **项目定位** | 基于大模型的语音控制桌面应用 |
| **竞赛类型** | 校招比赛 |
| **截止时间** | 2025年10月26日 22:00 |
| **可用时间** | 5天（120小时） |
| **目标系统** | Windows 10/11 |
| **开发策略** | MVP优先，保证核心功能完整 |

---

## 🎯 明确的需求描述

### 核心功能需求

#### 1. 语音交互能力
- **输入**: 用户通过麦克风说出自然语言指令
- **输出**: 系统语音反馈执行状态和结果
- **要求**: 
  - 支持连续对话（上下文记忆）
  - 识别准确率 > 90%
  - 响应时间 < 3秒

#### 2. 基础控制能力（Layer 1）
必须实现的5个核心能力：
1. **应用控制**: 打开/关闭应用程序（如音乐播放器、浏览器）
2. **文件操作**: 打开/创建/搜索文件
3. **浏览器操作**: 打开指定网站、搜索内容
4. **文本处理**: 创建并写入文档内容
5. **多媒体控制**: 播放音乐/视频、控制音量

#### 3. 任务编排能力（Layer 2）
实现2个复杂场景：
1. **场景1: "准备工作"**
   - 打开工作相关应用（VS Code、浏览器、音乐）
   - 设置合适的音量和屏幕亮度
   - 打开今日任务清单

2. **场景2: "创作模式"**
   - 打开文档编辑器
   - 根据主题搜索相关资料
   - 播放轻音乐
   - 生成文章大纲

#### 4. 智能决策能力（Layer 3）
- AI自主理解复杂指令
- 自动拆解为多步骤任务
- 根据执行结果调整后续步骤
- 示例："帮我整理桌面文件" → AI分析文件类型 → 自动分类归档

---

## 🏗️ 技术实现方案

### 技术栈选型

#### 前端技术栈
```yaml
框架: Electron 28.x
UI库: React 18 + TypeScript
状态管理: Zustand (轻量级)
UI组件: Ant Design / TailwindCSS
实时通信: WebSocket
```

#### 后端技术栈
```yaml
框架: Python 3.10 + FastAPI
AI框架: LangChain 0.1.x
异步处理: asyncio + uvicorn
进程管理: multiprocessing
```

#### AI服务层
```yaml
大模型: 
  - 主选: DeepSeek API (免费额度500万tokens)
  - 备选: 通义千问 (免费额度100万tokens)
Agent框架: LangChain ReAct Agent
Function Calling: 自定义工具集
```

#### 语音服务层
```yaml
语音识别 (STT):
  - 主选: 阿里云智能语音 (新用户免费3个月)
  - 备选: 讯飞开放平台 (免费500次/天)
  
语音合成 (TTS):
  - 主选: 阿里云智能语音
  - 备选: Edge-TTS (微软免费)
```

#### 系统控制层
```yaml
Windows自动化:
  - pyautogui (跨平台基础操作)
  - pywinauto (Windows专用高级控制)
  - psutil (进程管理)
  - win32api (系统API调用)
```

#### 数据存储层
```yaml
配置存储: JSON文件
历史记录: SQLite 3
会话缓存: Redis (可选)
```

---

## 🎨 架构设计概览

### 整体架构图
```
┌────────────────────────────────────────────────────────┐
│                    Electron 主进程                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  渲染进程管理  │  │  IPC通信管理  │  │  生命周期管理  │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
└────────────────────────────────────────────────────────┘
                          ↕ IPC
┌────────────────────────────────────────────────────────┐
│                 Electron 渲染进程 (React)                │
│  ┌──────────────────────────────────────────────────┐  │
│  │  UI Layer                                         │  │
│  │  ┌─────────┐  ┌─────────┐  ┌──────────────────┐ │  │
│  │  │ 语音输入  │  │ 对话面板  │  │  执行流程可视化  │ │  │
│  │  └─────────┘  └─────────┘  └──────────────────┘ │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────┘
                          ↕ WebSocket/HTTP
┌────────────────────────────────────────────────────────┐
│              Python FastAPI 后端服务                     │
│  ┌──────────────────────────────────────────────────┐  │
│  │  API Gateway Layer                                │  │
│  │  /api/voice/recognize  /api/chat  /api/execute   │  │
│  └──────────────────────────────────────────────────┘  │
│                          ↓                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Voice Service Layer                              │  │
│  │  STT Service  ←→  TTS Service                    │  │
│  └──────────────────────────────────────────────────┘  │
│                          ↓                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │  AI Agent Layer (LangChain)                       │  │
│  │  Intent Parser → Task Planner → Tool Selector    │  │
│  └──────────────────────────────────────────────────┘  │
│                          ↓                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Task Orchestration Layer                         │  │
│  │  Task Queue → Executor → Result Collector        │  │
│  └──────────────────────────────────────────────────┘  │
│                          ↓                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Tool Plugin Layer (能力插件)                      │  │
│  │  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐        │  │
│  │  │App控制│ │File操作│ │Browser│ │Text处理│ ...    │  │
│  │  └───────┘ └───────┘ └───────┘ └───────┘        │  │
│  └──────────────────────────────────────────────────┘  │
│                          ↓                              │
│  ┌──────────────────────────────────────────────────┐  │
│  │  OS Interface Layer                               │  │
│  │  Windows API Adapter (pyautogui/pywinauto)       │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────┘
                          ↓
┌────────────────────────────────────────────────────────┐
│                  Windows 操作系统                        │
│  Applications  │  File System  │  Browser  │  Media    │
└────────────────────────────────────────────────────────┘
```

---

## 🔧 技术约束

### 必须遵守的约束

#### 1. 时间约束
- **硬约束**: 10月26日22:00前完成
- **开发周期**: 5天
- **策略**: MVP优先，核心功能完整 > 功能丰富

#### 2. 成本约束
- **预算**: 尽量使用免费服务
- **API额度**:
  - DeepSeek: 500万tokens免费
  - 阿里云语音: 新用户免费3个月
- **回退方案**: 准备开源替代方案

#### 3. 技术约束
- **操作系统**: 仅支持Windows 10/11
- **Python版本**: 3.10+
- **Node版本**: 18.x LTS
- **浏览器**: Chromium内核（Electron自带）

#### 4. 安全约束
- **必须实现**: 危险操作二次确认
- **白名单机制**: 限制可执行的操作范围
- **用户授权**: 首次运行需要用户授予系统权限
- **日志记录**: 所有操作可追溯

#### 5. 性能约束
- **语音识别延迟**: < 2秒
- **AI响应时间**: < 5秒
- **任务执行反馈**: 实时进度更新
- **内存占用**: < 500MB

---

## 🎯 集成方案

### 外部服务集成

#### DeepSeek API集成
```python
# 配置方式
DEEPSEEK_API_KEY=your_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1

# 调用限制
- 速率限制: 60次/分钟
- 单次tokens: < 4000
- 超时设置: 30秒
```

#### 阿里云语音集成
```python
# 配置方式
ALI_APPKEY=your_appkey
ALI_ACCESS_KEY=your_access_key
ALI_SECRET_KEY=your_secret_key

# 参数配置
- 采样率: 16000Hz
- 音频格式: PCM
- 语言: zh-CN
```

### 系统集成

#### Windows API集成
- **权限要求**: 管理员权限（首次运行提示）
- **系统版本**: Windows 10 1809+
- **依赖检查**: 启动时检查必要DLL

#### 应用程序集成
支持控制的应用类型：
1. **标准Windows应用**: 通过进程名/窗口标题控制
2. **UWP应用**: 通过Windows API控制
3. **浏览器**: 通过命令行参数或Selenium
4. **Office应用**: 通过COM接口（可选）

---

## ✅ 验收标准

### 功能验收标准

#### A. 基础功能验收
- [x] 语音唤醒并识别指令，准确率 > 85%
- [x] 5个基础控制能力全部可用
- [x] 每个操作有语音/文字反馈
- [x] 错误情况有友好提示

#### B. 任务编排验收
- [x] 2个复杂场景可完整执行
- [x] 执行过程可视化展示
- [x] 中间失败能够优雅处理
- [x] 用户可中断执行

#### C. AI能力验收
- [x] 理解复杂自然语言指令
- [x] 自动拆解为步骤并执行
- [x] 根据上下文理解指代（"打开它"、"再来一次"）
- [x] 执行结果智能总结

#### D. 用户体验验收
- [x] 界面美观现代（参考主流AI助手）
- [x] 操作流畅无卡顿
- [x] 实时语音波形展示
- [x] 执行流程图形化展示

#### E. 安全性验收
- [x] 危险操作有二次确认
- [x] 无法执行系统破坏性操作
- [x] API密钥安全存储（.env文件）
- [x] 错误不导致系统崩溃

---

## 📦 交付物清单

### 必须交付

#### 1. 源代码
```
VoicePC/
├── frontend/          # Electron + React前端
├── backend/           # Python FastAPI后端
├── docs/              # 项目文档
├── tests/             # 测试用例
├── scripts/           # 部署脚本
├── .env.example       # 环境变量模板
├── requirements.txt   # Python依赖
├── package.json       # Node依赖
└── README.md          # 项目说明
```

#### 2. 文档
- [x] README.md - 项目介绍和快速开始
- [x] INSTALL.md - 详细安装指南
- [x] USER_GUIDE.md - 使用手册
- [x] API_DOCS.md - API文档
- [x] ARCHITECTURE.md - 架构说明

#### 3. 演示材料
- [x] 演示视频（5-10分钟）
- [x] PPT/演示文稿
- [x] 测试用例录屏

#### 4. 部署包
- [x] Windows安装程序（.exe）
- [x] 依赖检查脚本
- [x] 一键启动脚本

---

## 🎨 任务边界和限制

### 明确包含的功能
✅ **Layer 1 - 基础控制**
- 应用启动/关闭
- 文件打开/创建/搜索
- 浏览器打开网页
- 文档写入内容
- 多媒体播放控制

✅ **Layer 2 - 任务编排**
- "准备工作"场景
- "创作模式"场景
- 自定义场景配置（JSON配置文件）

✅ **Layer 3 - 智能决策**
- 自然语言意图理解
- 多步骤任务规划
- 执行失败自动重试
- 结果智能总结

✅ **交互体验**
- 语音连续对话
- 实时执行可视化
- 历史记录查询
- 设置和配置界面

---

### 明确排除的功能
❌ **不在范围内**
- 移动端支持（仅桌面）
- macOS/Linux支持
- 远程控制功能
- 多用户管理
- 云端同步
- 插件市场
- 语音训练/定制
- 高级图像识别
- 邮件客户端深度集成
- Office宏编程
- 网络自动化爬虫

---

### 降级方案（时间不足时）
如果开发时间不足，优先级排序：

**必须完成（P0）**:
1. 语音识别和合成
2. AI意图理解
3. 3个基础控制能力（应用、文件、浏览器）
4. 1个复杂场景
5. 基础UI界面

**重要但可裁剪（P1）**:
1. 5个基础能力全部实现
2. 2个复杂场景
3. 执行流程可视化
4. 上下文记忆

**锦上添花（P2）**:
1. 美化UI动画
2. 高级配置项
3. 详细日志系统
4. 性能优化

---

## 🚀 开发里程碑

### Day 1 (10月21日) - 架构与基础框架
- [x] 完成CONSENSUS文档
- [ ] 完成DESIGN架构设计
- [ ] 完成TASK任务拆解
- [ ] 搭建Electron项目框架
- [ ] 搭建FastAPI项目框架
- [ ] 配置开发环境

### Day 2 (10月22日) - 核心模块开发
- [ ] 实现语音识别模块
- [ ] 实现AI Agent核心
- [ ] 实现3个基础工具插件
- [ ] 前后端通信打通

### Day 3 (10月23日) - 功能完善
- [ ] 完成5个基础能力
- [ ] 实现任务编排引擎
- [ ] 实现第1个复杂场景
- [ ] 完善UI交互

### Day 4 (10月24日) - 高级功能
- [ ] 实现第2个复杂场景
- [ ] 执行流程可视化
- [ ] 安全控制机制
- [ ] 错误处理完善

### Day 5 (10月25日) - 测试与优化
- [ ] 完整功能测试
- [ ] 性能优化
- [ ] 演示视频录制
- [ ] 文档编写

### Day 6 (10月26日) - 最终提交
- [ ] 最终测试
- [ ] 打包发布
- [ ] 准备演示材料
- [ ] 22:00前提交

---

## 📝 不确定性解决记录

### 已解决的问题
1. ✅ **操作系统选择**: Windows（用户当前系统）
2. ✅ **大模型选择**: DeepSeek（免费额度充足）
3. ✅ **语音技术**: 阿里云语音（新用户免费）
4. ✅ **时间约束**: 5天，MVP策略
5. ✅ **安全级别**: 危险操作二次确认

### 待运行时确认
- 具体支持的应用列表（根据用户常用应用调整）
- 语音唤醒词（默认："小助手"）
- UI主题色（默认：科技蓝）

---

## ✅ 最终确认

### 项目共识声明
我们将开发一个名为 **VoicePC** 的智能语音电脑助手，它能够：
1. 通过自然语言语音控制Windows电脑
2. 完成5类基础操作（应用、文件、浏览器、文本、多媒体）
3. 智能编排2个复杂工作场景
4. 展示AI的思考和执行过程
5. 在5天内完成MVP版本用于比赛演示

### 技术共识
- 采用Electron + React + Python FastAPI架构
- 使用DeepSeek大模型和阿里云语音服务
- 基于LangChain实现Agent能力
- 确保安全性和用户体验

### 风险共识
- 时间紧张，优先保证核心功能完整
- 外部API依赖，需准备降级方案
- 首次使用需要用户配置API密钥

---

**共识确认人**: AI架构师  
**确认时间**: 2025-10-21  
**下一步**: 进入架构设计阶段（DESIGN文档）

---

